{% import "_charts.html" as charts with context %}
{% import "_globals.html" as globals with context %}
{% set page_title = globals.all_pages[active_page].0 if not page_title else page_title %}
{% set short_title = page_title if not short_title else short_title %}
{% if not g.partial %}
<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <title>{{ short_title }} - {{ ledger.options.title }}</title>
  </head>
  <body>
    <header>
        <image src="{{ url_for('static', filename='images/fava.svg') }}" />
      <h1>
        {{ ledger.options.title or 'fava' }}{{ ' ▾' if config['LEDGERS']|length > 1 else '' }}<strong class="page-title">{{ page_title }}</strong>
        <button type=button id="reload-page" class="reload-page hidden" data-event="reload-page" data-key="r" data-reload-text="{{ _('File change detected. Click to reload.') }}">&#8635;</button>
        {% if config['LEDGERS']|length > 1 %}
        <div class="beancount-files">
          <ul>
            {% for file_slug, file_ledger in config['LEDGERS'].items() %}
            <li>
              <a{% if file_slug == g.beancount_file_slug %} class="active"{% endif %} href="{{ url_for('report', report_name='income_statement', bfile=file_slug) }}" data-remote>{{ file_ledger.options.title or 'fava' }}</a>
            </li>
            {% endfor %}
          </ul>
        </div>{% endif %}
      </h1>
      {% include "_entry_filters.html" %}
    </header>
    <button class="aside-button" type="button" data-event="toggle-aside">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="32px" width="32px" version="1.0" viewBox="0 0 24 24"><circle cx="12" cy="12" r="2"/><circle cx="12" cy="5" r="2"/><circle cx="12" cy="19" r="2"/></svg>
    </button>
    <aside>{% include "_aside.html" %}</aside>
    <article>
      {%- endif %}
      {% block content %}{% endblock %}
      <input type="hidden" id="data-document-title" value="{{ '{} - {}'.format(short_title, ledger.options.title) }}">
      <input type="hidden" id="data-error-count" value="{{ ledger.errors|length }}">
      <script type="text/html" id="data-page-title">{{ page_title }}</script>
      <script type="application/json" id="chart-data">{{ charts.chart_data|tojson|safe }}</script>
      <script type="application/json" id="ledger-data">{{ {
        'accountURL': url_for('account', name='REPLACEME'),
        'baseURL': url_for('index'),
        'accounts': ledger.attributes.accounts,
        'options': ledger.options,
        'incognito': config.get('INCOGNITO', False),
        'favaOptions': ledger.fava_options,
        'accounts': ledger.attributes.accounts,
        'currencies': ledger.attributes.currencies,
        'payees': ledger.attributes.payees,
        'tags': ledger.attributes.tags,
        'years': ledger.attributes.years,
    }|tojson|safe }}</script>
      {%- if not g.partial %}
    </article>
    {% include "_overlays.html" %}
    <ul id="notifications" class="notifications"></ul>
    <div id="tooltip" class="tooltip"></div>
    <script type="text/javascript" src="{{ url_for('static', filename='gen/app.js') }}"></script>
    <footer class="footer">
        {% if current_user.is_authenticated %}
        <b>Logged in as {{ current_user.name }}</b>
        | <a href="{{ url_for('logout') }}" always-fully-navigate>logout</a> |
        {% endif %}
        Copyright &copy; 2015-2016 Dominik Aumayr fava project contributors.
    </footer>
  </body>
</html>
{%- endif %}
